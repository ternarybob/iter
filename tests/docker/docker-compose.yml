# Docker Compose for iter-service testing
# Completely isolated containers - no shared directories with host

services:
  # Run all tests (default)
  test:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile
    environment:
      - ITER_TEST_MODE=1
    command: go test -p 1 -v -timeout 300s ./tests/...

  # Run service tests only
  test-service:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile
    environment:
      - ITER_TEST_MODE=1
    command: go test -p 1 -v -timeout 120s ./tests/service/...

  # Run API tests only
  test-api:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile
    environment:
      - ITER_TEST_MODE=1
    command: go test -p 1 -v -timeout 120s ./tests/api/...

  # Run UI tests only
  test-ui:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile
    environment:
      - ITER_TEST_MODE=1
    command: go test -p 1 -v -timeout 120s ./tests/ui/...

  # Interactive shell for debugging
  shell:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile
    environment:
      - ITER_TEST_MODE=1
    command: /bin/bash
    stdin_open: true
    tty: true
