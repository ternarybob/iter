# Docker Compose for iter-service testing
# Results directory is mounted to persist screenshots and test artifacts

services:
  # Run all tests (default)
  test:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile
    environment:
      - ITER_TEST_MODE=1
      - CHROME_BIN=/usr/bin/chromium
      - CHROMEDP_NO_SANDBOX=true
    volumes:
      - ../results:/app/tests/results
    command: go test -p 1 -v -timeout 300s ./tests/...

  # Run service tests only
  test-service:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile
    environment:
      - ITER_TEST_MODE=1
    volumes:
      - ../results:/app/tests/results
    command: go test -p 1 -v -timeout 120s ./tests/service/...

  # Run API tests only
  test-api:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile
    environment:
      - ITER_TEST_MODE=1
    volumes:
      - ../results:/app/tests/results
    command: go test -p 1 -v -timeout 120s ./tests/api/...

  # Run UI tests only
  test-ui:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile
    environment:
      - ITER_TEST_MODE=1
      - CHROME_BIN=/usr/bin/chromium
      - CHROMEDP_NO_SANDBOX=true
    volumes:
      - ../results:/app/tests/results
    command: go test -p 1 -v -timeout 120s ./tests/ui/...

  # Interactive shell for debugging
  shell:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile
    environment:
      - ITER_TEST_MODE=1
      - CHROME_BIN=/usr/bin/chromium
      - CHROMEDP_NO_SANDBOX=true
    volumes:
      - ../results:/app/tests/results
    command: /bin/bash
    stdin_open: true
    tty: true
