# iter-workflow Skill Update

## Summary

Updated `skills/iter-workflow/SKILL.md` to follow the same architectural pattern as `/iter:run` while supporting custom workflow specifications.

## Key Changes

### 1. Structured Phases (matching /iter:run)

The skill now follows the same 4-phase structure as /iter:run:

- **Phase 1: ARCHITECT** - Workflow setup and documentation
- **Phase 2: WORKER** - Execute iterations
- **Phase 3: VALIDATOR** - Check iteration success
- **Phase 4: COMPLETE** - Final summary

### 2. Iteration Structure (from example-workflow.md)

Each iteration follows the same 4-step structure:

1. **GET STATUS** - Collect system state, logs, verification results
2. **REVIEW & PLAN** - Analyze issues, select ONE priority issue, create action plan
3. **IMPLEMENT** - Execute fixes, document each action, redeploy if needed
4. **SUMMARIZE** - Record outcomes, verify results, decide continue/stop

### 3. Task Management Integration

Leverages Claude Code's task management tools:

- Create tasks for each iteration upfront with dependencies
- Mark tasks `in_progress` before starting
- Only mark `completed` when iteration passes
- Use `TaskList` to track progress

### 4. Documentation Requirements

The ARCHITECT phase now requires:

- `$WORKDIR/architecture.md` - Document workflow architecture
- `$WORKDIR/workflow-state.md` - Track workflow state
- Iteration directory structure: `status/`, `logs/`, `fixes/`
- `notes.md` for each iteration with thinking/reasoning
- `summary.md` for each iteration with outcomes

### 5. Execution Rules

Aligned with iter execution philosophy:

- AUTONOMOUS EXECUTION - Execute commands directly
- ONE ISSUE PER ITERATION - Fix highest priority only
- DOCUMENT THINKING - Always explain reasoning
- READ PREVIOUS NOTES - Review before each iteration
- FOLLOW WORKFLOW PRIORITIES - Use workflow priority rules
- VERIFY CHANGES - Always verify fixes work

## Usage

The `/iter-workflow` skill accepts either:

1. **File path** (recommended):
   ```bash
   /iter-workflow docs/example-workflow.md
   ```
   The skill will read the file content and pass it to the `iter workflow` command.

2. **Direct markdown content**:
   ```bash
   /iter-workflow "# My Workflow\n## Configuration\n..."
   ```
   For inline workflow specifications (less common).

The workflow specification (like `docs/example-workflow.md`) should include:

1. **SOURCES & SCOPE** - Code locations, services, endpoints
2. **EXECUTION RULES** - Autonomous execution guidelines
3. **CONFIGURATION** - MIN_ITERATIONS, MAX_ITERATIONS, etc.
4. **ITERATION STRUCTURE** - Detailed steps for each iteration
5. **PRIORITY ORDER** - Rules for selecting which issue to fix
6. **SUCCESS CRITERIA** - When to stop with success

## How It Leverages /iter:run

The updated skill reuses /iter:run concepts:

- **Binary handles state** - `iter workflow` command loads the workflow spec
- **Task-based execution** - Uses TaskCreate/TaskUpdate/TaskList
- **Sequential dependencies** - Tasks blocked by previous tasks
- **Phase-based structure** - ARCHITECT → WORKER → VALIDATOR → COMPLETE
- **Adversarial validation** - Check success criteria before proceeding

## Differences from /iter:run

| Feature | /iter:run | /iter-workflow |
|---------|-----------|----------------|
| Input | Task description string | Workflow spec markdown file |
| Steps | Generated by ARCHITECT | Defined in workflow spec (iterations) |
| Structure | step_1.md, step_2.md | iteration-N/notes.md, summary.md |
| Validation | Pass/reject specific steps | Check iteration success criteria |
| Scope | Single implementation task | Multiple iteration cycles |

## Example Workflow Spec Structure

See `docs/example-workflow.md` for a complete example. Key sections:

```markdown
# Workflow Name

## SOURCES & SCOPE
- Code locations
- Services/containers
- Endpoints

## EXECUTION RULES
- Autonomous execution
- Stop conditions

## CONFIGURATION
MIN_ITERATIONS=2
MAX_ITERATIONS=5
STABILIZATION_WAIT=60

## ITERATION STRUCTURE
### STEP 1: GET STATUS
[Commands to collect status]

### STEP 2: REVIEW & PLAN
[Analysis requirements]

### STEP 3: IMPLEMENT
[Fix application pattern]

### STEP 4: SUMMARIZE
[Summary requirements]

## PRIORITY ORDER
[Table of priority levels]

## SUCCESS CRITERIA
[Conditions for SUCCESS vs INCOMPLETE]
```

## Testing

Built successfully:
```bash
./scripts/build.sh
# Version: 2.1.20260126-1305
```

The skill is now included in the plugin distribution at:
- `bin/skills/iter-workflow/SKILL.md`
